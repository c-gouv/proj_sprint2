<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitteya Tech | Suporte IA</title>
    <link rel="stylesheet" href="../css/headerDashboard.css">
    <link rel="stylesheet" href="../css/chatIA.css">
    <script src="https://kit.fontawesome.com/d94da5d75d.js" crossorigin="anonymous"></script>
</head>
<body>
    <header id="header"></header>
    <main>
        <div class="topHeader" id="banana"></div>
        <div class="contentContainer">
            <div class="content">
                <div class="containerPergunta">
                    <textarea type="text" rows="1" id="inputPergunta" class="textoPergunta" placeholder="Pergunte ao Leornado" required></textarea>    
                    <i class="fa-solid fa-arrow-right" onclick="gerarResposta()" id="botaoEnviar"></i>
                </div>
                <div class="containerChat" id="chatMensagem">
                    <div class="direita">
                        <div class="respostaChat msgUser">
                            <span>Eu quero saber como eu configuro o sensor para dias de chuvas</span>
                        </div>
                    </div>
                    <div class="respostaChat msgIA">
                        Lorem ipsum dolor sit amet consectetur adipisicing elit. Architecto animi ducimus harum error? Beatae ducimus atque, repellendus odio voluptatem officia modi quis sit dicta enim doloribus molestias cumque tenetur aliquam.
                    </div>
                </div>
            </div>
        </div>
    </main>
</body>

<!-- <script src="../js/scriptHeader.js"></script>
<script src="../js/criarHeaders.js"></script> -->
</html>

<script>
    // Estilização da caixa de enviar mesagem
    const textarea = document.getElementById("inputPergunta");
    const btnEnviar = document.getElementById("botaoEnviar");

    function corBotao() {
        if(textarea.value.trim() === "") {
            btnEnviar.style.backgroundColor = "var(--cor-destaque)";
        } else {
            btnEnviar.style.backgroundColor = "var(--cor-pseudoTexto)";
        }
    }
    // textarea.addEventListener("input", corBotao());
    textarea.addEventListener("input", element => {
        textarea.style.height = "max-content";
        let taHeight = element.target.scrollHeight;
        textarea.style.height = `${taHeight}px`;
        corBotao()});

    // Imprimir mensagem na tela
    async function gerarResposta() {
        const pergunta = document.getElementById('inputPergunta').value;
        const mensagemUser= `<div class="direita">
                                <div class="respostaChat msgUser">
                                    <span>${pergunta}</span>
                                </div>
                            </div>`
        textarea.value = "";
        corBotao();

        if (pergunta.trim() != "") {
            document.getElementById("chatMensagem").innerHTML += mensagemUser
        }

        // Geração de resposta da IA
        fetch('/gemini/perguntar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ pergunta })
        }).then(async function (resposta){
            const data = await resposta.json();

            // resposta.style.display = 'block';
            document.getElementById('chatMensagem').innerHTML += data.resultado;
            
        });

        
    }

    // Tecla ENTER enviar a mensagem
    textarea.onkeypress = function(event) {
        if(event.keyCode==13) {
            event.preventDefault();
            gerarResposta()
        }
    }
</script>